ThingSpeak.Widget=function(){const e={GAUGE:0,NUMERIC_DISPLAY:1,LAMP_INDICATOR:2,IMAGE_DISPLAY:3};var t,a=(t={CREATE_MODAL_ID:"configure_widget_modal_content_body",WIDGET_TABLE_ID:"#widget_params_config_",MAX_FIELD_WARNING:"Max should be greater than Min",NUM_DISPLAY_SCALE_LIST:"1,2,3,4,5",LAMP_INDICATOR_THRESHOLD_LIST:"is greater than,is greater than or equal to,is less than,is less than or equal to,is equal to,is not equal to",IMAGE_DISPLAY_ROTATE_LIST:"0\xb0,90\xb0,180\xb0,270\xb0"},{get:function(e){return t[e]}}),l=function(e,t){var l={widget_type:t},n=a.get("CREATE_MODAL_ID");$.ajax({method:"GET",url:"/channels/"+e+"/widgets/new.json",data:l,dataType:"json",success:function(e){return ThingSpeak.Widget.constructConfigModal(e.widget_params,e.widget_type,n),e},error:function(){c.showErrorBanner()}})},n=function(t,a,l){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"",r=l+n,i=t.params,s=t.enabled_fields,o=t.image_channels;switch(a){case e.GAUGE:d.formGaugeParams(r,i,s,n,a);break;case e.NUMERIC_DISPLAY:d.formNumericDisplayParams(r,i,s,n,a);break;case e.LAMP_INDICATOR:d.formLampIndicatorParams(r,i,s,n,a);break;case e.IMAGE_DISPLAY:d.formImageDisplayParams(r,i,o,n,a)}},r=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"",t=$(a.get("WIDGET_TABLE_ID")+e),l={},n=!1,r=function(){var e="",t="";this.name.startsWith("range")?(m.getGaugeRange(this,l),n=!0):(e=this.value,t=this.name,l[t]=e)};return t.find(".form-control, .form-select, .form-check-input").each(r),l.range=n?l.range.filter(function(e){return e}):"",l},i=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"",t={},l=[];l[0]=new Object,l[1]=new Object;var n=l[0],r=l[1],i=a.get("NUM_DISPLAY_SCALE_LIST"),s=$(a.get("WIDGET_TABLE_ID")+e),o=function(e,t){$("#"+e)[0].checked?t.selected=1:t.selected=0},c=function(){this.name.startsWith("data_type")||(t[this.name]=this.value)},d=function(){this.name.startsWith("data_type_integer_")&&(n.name="integer",o(this.id,n)),this.name.startsWith("data_type_decimal_")&&(r.name="decimal",o(this.id,r),r.metadata=new Object,r.metadata.scaleRange=i,r.metadata.scaleDefault=document.getElementById("data_type_select_"+e).value)};return s.find(".form-control, .form-select").each(c),s.find(".radio-control").each(d),t.data_type=l,t},s=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"",t={},l=[];l[0]=new Object;var n=l[0],r=a.get("LAMP_INDICATOR_THRESHOLD_LIST"),i=function(){var a="",i="";this.name.startsWith("threshold_type")?(n.range=r,n["default"]=document.getElementById("threshold_type_"+e).value,t.threshold_type=l):(i=this.name,a=this.value,t[i]=a)};return $(a.get("WIDGET_TABLE_ID")+e).find(".form-control, .form-select").each(i),t},o=function(){const e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"",t=$(a.get("WIDGET_TABLE_ID")+e),l={};var n=[];n[0]=new Object;var r=n[0],i=a.get("IMAGE_DISPLAY_ROTATE_LIST");const s=function(){this.name.startsWith("rotate")?(r.range=i,r["default"]=document.getElementById("rotate_"+e).value,l.rotate=n):l[this.name]=this.value};return t.find(".form-control, .form-select").each(s),l};this.gaugeRemoveRange=function(e){var t=e.getAttributeNode("name").value,a=$("#range_meta_key_"+t).html();""!=document.getElementById("range_meta_key_"+t)&&Number(a)>0&&(document.getElementById("range_meta_key_"+t).innerHTML=Number(a)-1),$(e).parent().remove()},this.disableScaleAndSelectInteger=function(e){e=e!==undefined?e:"";var t=document.getElementById("data_type_select_"+e),a=document.getElementById("data_type_selectText_"+e);t.disabled=!0,a.style.color="grey",$("#data_type_integer_"+e).prop("checked",!0),$("#data_type_decimal_"+e).prop("checked",!1)},this.enableScaleAndSelectDecimal=function(e){e=e!==undefined?e:"";var t=document.getElementById("data_type_select_"+e),a=document.getElementById("data_type_selectText_"+e);t.disabled=!1,a.style.color="black",$("#data_type_integer_"+e).prop("checked",!1),$("#data_type_decimal_"+e).prop("checked",!0)};var c={capitalizeKeys:function(e){var t="";return e.split("_").forEach(function(e){t+=e.charAt(0).toUpperCase()+e.slice(1)+" "}),t.trim()},showErrorBanner:function(){$("#invalid_widget_type").show(),$("#configure_widget_parameters_modal").modal("toggle")}},d={formGaugeParams:function(e,t,a,l,n){var r=0,i=1,s="<table id='widget_params_config_"+l+"'>";for(key in t)switch(key){case"min":case"max":case"tick_interval":s+=m.gaugeTableConfigHelper(key,t[key],"number",l,n);break;case"update_interval":s+=m.gaugeTableConfigHelper(key,t[key],"number",l,n,"second(s)","",i,n);break;case"display_value":s+=m.gaugeTableConfigHelper(key,t[key],"checkbox",l,n);break;case"units":case"name":case"title":case"field":s+=m.setUnitsNameField(key,t,l,a,i,n);break;case"range":r=Object.keys(t[key]).length,s+=m.setGaugeRange(t,key,l)}document.getElementById(e).innerHTML=s+" <br/></table> <span id='gauge_add_range_"+l+"'class='fa fa-plus fa-mid-align' aria-hidden='true'></span> <div id='range_meta_key_"+l+"' style='display: none; onclick='gaugeAddRange(this)'>"+r+"</div><div id='widget_type_metadata_"+l+"' style='display: none;'>"+n+"</div>",m.gaugeDefaultCheckboxVal(l)},formNumericDisplayParams:function(e,t,a,l,n){var r="<table id='widget_params_config_"+l+"'>",i=2;for(key in t)switch(key){case"units":case"name":case"field":r+=m.setUnitsNameField(key,t,l,a,i,n);break;case"update_interval":r+=m.gaugeTableConfigHelper(key,t[key],"number",l,n,"second(s)","",i);break;case"data_type":var s=t[key];r+=m.setNumericDisplayDataType(t[key],key,l)}document.getElementById(e).innerHTML=r+"<div id='widget_type_metadata_"+l+"' style='display: none;'>"+n+"</div>",m.setNumericDisplayRadioOptions(s,l)},formLampIndicatorParams:function(e,t,a,l,n){params=m.fixRawParamsOrder(t);var r="<table id='widget_params_config_"+l+"'>",i=1,s="";for(key in params)switch(key){case"name":r+="<tr>"+m.setUnitsNameField(key,params,l,a,i,n)+"</tr>";break;case"field":case"threshold_type":case"threshold":s+=m.setLampThreshold(key,params,l,a,i,n);break;case"update_interval":r+="<tr>"+s+"</tr>",r+="<tr>"+m.gaugeTableConfigHelper(key,params[key],"number",l,n,"second(s)","",i)+"</tr>";break;case"color":r+=m.setLampColor(params,key,l)}document.getElementById(e).innerHTML=r+"<div id='widget_type_metadata_"+l+"' style='display: none;'>"+n+"</div>"},formImageDisplayParams:function(e,t,a,l,n){var r="<table id='widget_params_config_"+l+"'>",i=2;for(key in t)switch(key){case"name":case"image_channel":r+=m.setUnitsNameField(key,t,l,a,i,n);break;case"update_interval":r+=m.gaugeTableConfigHelper(key,t[key],"number",l,n,"second(s)","",i);break;case"rotate":r+=m.setRotateList(t[key],key,l,i)}document.getElementById(e).innerHTML=r+"<div id='widget_type_metadata_"+l+"' style='display: none;'>"+n+"</div>"}},m={setUnitsNameField:function(e,t,a,l,n,r){switch(e){case"units":return m.gaugeTableConfigHelper(e,t[e],"text",a,r,"","Enter Measurement Units",n);case"name":case"title":return m.gaugeTableConfigHelper(e,t[e],"text",a,r,"","Enter Name for the widget",n);case"field":case"image_channel":var i=t[e].split(",");return m.setFieldDropDown(e,i,a,l,n,r)}},setGaugeRange:function(e,t,a){var l="";for(var n in l+="<tr><td class='widget-form-label widget-table-cells'>  <label class='col-form-label'>"+c.capitalizeKeys(t)+" </label></td>",e[t])l+="<td class='widget-table-cells'><input class='form-control' type='number' step='any' name='range_start_"+n+"' value='"+(""===e[t][n].start?0:e[t][n].start)+"'></input></td><td class='widget-table-cells'><input class='form-control' type='number' step='any' name='range_end_"+n+"' value='"+(""===e[t][n].end?0:e[t][n].end)+"' > </input></td> <td class='widget-table-cells'><input class='form-control form-control-color' type='color' name='range_color_"+n+"'  value='"+e[t][n].color+"' >  </input></td><td name='"+a+"' class='color-range-row' onclick='gaugeRemoveRange(this)'><span  class='close' aria-hidden='true'>&times;</span></td><tr></tr><td></td>";return l},setLampColor:function(e,t,a){return colorLabel="<tr><td class='widget-form-label widget-table-cells'><label class='col-form-label'>"+c.capitalizeKeys(t)+" </label></td>",colorCell="<td><input class='form-control form-control-color' type='color' id='lamp_color_"+a+"' name='color' value='"+e[t]+"' >  </input></td>",colorLabel+colorCell},setNumericDisplayDataType:function(e,t,a){var l="";l+="<tr><td class='widget-form-label widget-table-cells'>  <label class='col-form-label'>"+c.capitalizeKeys(t)+" </label></td><td><input style='margin-right:4px;' class='radio-control' id='"+t+"_integer_"+a+"' type='radio' name='"+t+"_integer_"+a+"' onclick='disableScaleAndSelectInteger("+a+")' value='"+c.capitalizeKeys(e[0].name)+"'>"+c.capitalizeKeys(e[0].name)+"</input></td><td><input style='margin-right:4px;' class='radio-control' id='"+t+"_decimal_"+a+"' type='radio' name='"+t+"_decimal_"+a+"' onclick='enableScaleAndSelectDecimal("+a+")' value='"+c.capitalizeKeys(e[1].name)+"'>"+c.capitalizeKeys(e[1].name)+"</input></td>";var n=e[1].metadata.scaleRange.split(",").map(Number),r=Number(e[1].metadata.scaleDefault);return l+=m.setNumericDisplayScale(t,a,n,r)+"</tr>"},setLampThreshold:function(e,t,a,l,n,r){if("field"===e){var i=t[e].split(",");return m.setFieldDropDown(e,i,a,l,n,r)}return"threshold"===e?m.gaugeTableConfigHelper(e,t[e],"number",a,r,"","",n):m.setLampIndicatorThresholdType(t[e],e,a,n)},setNumericDisplayScale:function(e,t,a,l){for(var n="",r="",i=(n=l>0?l:1,0);i<a.length;i++)a[i]===n?r+="<option value='"+n+"' selected> "+n+" </option>":r+="<option value='"+a[i]+"'> "+a[i]+" </option>";return"<td><select class='form-select'  disabled ' id='"+e+"_select_"+t+"' name='"+e+"_select_"+t+"'>"+r+"</select></td><td style='font-size: 14px;'><p style='margin-left: 4px;' id='"+e+"_selectText_"+t+"' name='"+e+"_selectText_"+t+"'> (# of places)</p></td>"},setLampIndicatorThresholdType:function(e,t,a,l){for(var n="",r=e[0].range.split(","),i=e[0]["default"],s=0==i?0:i,o=0;o<r.length;o++)r[o]===i?n+="<option value='"+s+"' selected> "+s+" </option>":n+="<option value='"+r[o]+"'> "+r[o]+" </option>";return"<tr>"+"<td></td>"+("<td colspan='"+l+"' class='widget-table-cells'> <select class='form-control' id='"+t+"_"+a+"' name='"+t+"'>"+n+"</select></td>")+"</tr>"},setRotateList:function(e,t,a,l){for(var n="",r=e[0].range.split(","),i=e[0]["default"],s=0===i?0:i,o=0;o<r.length;o++)r[o]===i?n+="<option value='"+s+"' selected> "+s+" </option>":n+="<option value='"+r[o]+"'> "+r[o]+" </option>";return"<tr>"+("<td class='widget-table-cells widget-form-label'> <label class='col-form-label'>"+c.capitalizeKeys(t)+"</label></td>")+("<td colspan='"+l+"' class='widget-table-cells'> <select class='form-control' id='"+t+"_"+a+"' name='"+t+"'>"+n+"</select></td>")+"</tr>"},setFieldDropDown:function(e,t,a,l,n,r){var i="",s="",o="";return 1===t.length?l.split(",").forEach(function(e){e===t[0]?i+=" <option value='"+t+"' selected> "+t+" </option> ":i+=" <option value='"+e+"'> "+e+" </option> "}):l.split(",").forEach(function(e){i+=" <option value='"+e+"'> "+e+" </option> "}),s="<td class='widget-table-cells widget-form-label'> <label class='col-form-label'>"+c.capitalizeKeys(e)+"</label></td>",2!==r?"<tr>"+s+(o="<td colspan='"+n+"' class='widget-table-cells'> <select class='form-select' id='"+e+"_"+a+"' name='"+e+"'>"+i+"</select></td>")+"</tr>":(o="<td colspan='"+n+"' class='widget-table-cells'> <select class='form-select' style='margin-top:-0.5em;' id='"+e+"_"+a+"' name='"+e+"'>"+i+"</select></td>",conditionTextRow="<tr><td class='widget-table-cells widget-form-label'><label class='col-form-label'>Condition</label></td><td>If</td></tr>",fieldRow="<tr><td></td>"+o+"</tr>",conditionTextRow+fieldRow)},gaugeTableConfigHelper:function(e,t,l,n,r){var i=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"",s=arguments.length>6&&arguments[6]!==undefined?arguments[6]:"",o=arguments.length>7&&arguments[7]!==undefined?arguments[7]:"",d=a.get("MAX_FIELD_WARNING"),u="",g="";if("number"===l)var p=m.gaugeSetInputEvent(e);switch(e){case"max":var _="title='"+d+"'";break;case"name":case"title":"title"===e&&(e="name");var f="maxlength=80"}return u="<td class='widget-form-label widget-table-cells'> <label class='col-form-label'>"+c.capitalizeKeys(e)+"</label></td>","threshold"===e&&2===r?(g="<td colspan='"+o+"' class='widget-table-cells'><input style='margin-bottom:-0.5em';' class='form-control' "+_+" "+f+" placeholder ='"+s+" ' type='"+l+"' "+p+" id='"+e+"_"+n+"' name='"+e+"' value='"+t+"'> </input></td>",thresholdRow="<tr><td></td>"+g+"</tr>",thresholdTextRow="<tr><td class='widget-table-cells widget-form-label'><label class='col-form-label'></label></td><td>turn Lamp ON</td></tr>",thresholdRow+thresholdTextRow):"<tr>"+u+(g="<td colspan='"+o+"' class='widget-table-cells'><input class='"+("display_value"===e?"form-check-input":"form-control")+"' "+_+" "+f+" placeholder ='"+s+" ' type='"+l+"' "+p+" id='"+e+"_"+n+"' name='"+e+"' value='"+t+"'> </input></td><td class='widget-table-cells'> &nbsp "+i+"</td>")+"</tr>"},fixRawParamsOrder:function(e){var t=new Object;return t.name=e.name,t.field=e.field,t.threshold_type=e.threshold_type,t.threshold=e.threshold,t.update_interval=e.update_interval,t.color=e.color,t},gaugeSetInputEvent:function(e){switch(e){case"min":case"max":return"step='any'";case"tick_interval":return"step='any' oninput='validity.valid||(value=0)' min='0'";case"update_interval":return meter_data.is_free_user?"oninput='validity.valid||(value=15)' min='15'":"oninput='validity.valid||(value=1)' min='1'";case"threshold":return"step='any' oninput='validity.valid||(value=0)' ";default:return""}},gaugeDefaultCheckboxVal:function(e){var t=document.getElementById("display_value_"+e);t.checked="true"==t.value},getGaugeRange:function(e,t){var a,l=[],n={};t.hasOwnProperty("range")&&(l=t.range),gaugeElementValue=e.value,gaugeElementName=e.name.split("_")[1],a=e.name.split("_")[2],n[gaugeElementName]=gaugeElementValue,l[a]===undefined?l[a]=n:(n=l[a])[gaugeElementName]=gaugeElementValue,t.range=l},setNumericDisplayRadioOptions:function(e,t){1===Number(e[0].selected)&&disableScaleAndSelectInteger(t),1===Number(e[1].selected)&&enableScaleAndSelectDecimal(t)}};return{getNewWidgetFormElements:l,constructConfigModal:n,getGaugeParams:r,getNumericDisplayParams:i,getLampIndicatorParams:s,getImageDisplayParams:o,WIDGET_TYPE:e}}();